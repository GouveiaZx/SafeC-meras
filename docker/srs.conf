# SRS Configuration for NewCAM
# Simple Realtime Server configuration

listen              1935;
max_connections     1000;
srs_log_tank        file;
srs_log_file        ./objs/srs.log;

# HTTP API configuration
http_api {
    enabled         on;
    listen          8080;
    crossdomain     on;
}

# HTTP Server for HLS
http_server {
    enabled         on;
    listen          8081;
    dir             /var/www/streams;
    crossdomain     on;
}

# Stats configuration
stats {
    network         0;
    disk            sda sdb xvda xvdb;
}

# RTMP Vhost
vhost __defaultVhost__ {
    # Enable HLS
    hls {
        enabled         on;
        hls_path        /var/www/streams;
        hls_fragment    2;
        hls_window      60;
        hls_on_error    ignore;
    }
    
    # Enable HTTP FLV
    http_remux {
        enabled     on;
        mount       [vhost]/[app]/[stream].flv;
    }
    
    # DVR (Recording)
    dvr {
        enabled         off;
        dvr_path        /var/www/streams/records/[app]/[stream]/[2006]/[01]/[02]/[stream].[timestamp].flv;
        dvr_plan        session;
        dvr_duration    30;
        dvr_wait_keyframe   on;
    }
    
    # Security
    security {
        enabled         off;
        seo {
            enabled         on;
        }
    }
    
    # Transcode (optional)
    transcode {
        enabled     off;
        ffmpeg      /usr/local/bin/ffmpeg;
        
        engine low {
            enabled         on;
            vfilter {
                v               quiet;
                vf              scale=640:360;
            }
            vcodec          libx264;
            vbitrate        300;
            vfps            15;
            vwidth          640;
            vheight         360;
            vthreads        2;
            vprofile        baseline;
            vpreset         superfast;
            vparams {
                g               30;
                keyint_min      30;
            }
            acodec          aac;
            abitrate        32;
            asample_rate    22050;
            achannels       1;
            output          rtmp://127.0.0.1:[port]/[app]?vhost=[vhost]/[stream]_low;
        }
        
        engine medium {
            enabled         on;
            vfilter {
                v               quiet;
                vf              scale=854:480;
            }
            vcodec          libx264;
            vbitrate        800;
            vfps            25;
            vwidth          854;
            vheight         480;
            vthreads        2;
            vprofile        main;
            vpreset         fast;
            vparams {
                g               50;
                keyint_min      25;
            }
            acodec          aac;
            abitrate        64;
            asample_rate    44100;
            achannels       2;
            output          rtmp://127.0.0.1:[port]/[app]?vhost=[vhost]/[stream]_medium;
        }
        
        engine high {
            enabled         on;
            vfilter {
                v               quiet;
                vf              scale=1280:720;
            }
            vcodec          libx264;
            vbitrate        1500;
            vfps            30;
            vwidth          1280;
            vheight         720;
            vthreads        4;
            vprofile        high;
            vpreset         medium;
            vparams {
                g               60;
                keyint_min      30;
            }
            acodec          aac;
            abitrate        128;
            asample_rate    44100;
            achannels       2;
            output          rtmp://127.0.0.1:[port]/[app]?vhost=[vhost]/[stream]_high;
        }
    }
    
    # Forward (for clustering)
    forward {
        enabled         off;
        destination     127.0.0.1:19350;
    }
    
    # Play settings
    play {
        gop_cache       on;
        queue_length    10;
        time_jitter     full;
    }
    
    # Publish settings
    publish {
        mr              off;
        parse_sps       on;
    }
    
    # Refer settings
    refer {
        enabled         off;
        all             github.com github.io;
        publish         github.com github.io;
        play            github.com github.io;
    }
    
    # Bandwidth test
    bandcheck {
        enabled         off;
        key             "35c9b402c12a7246868752e2878f7e0e";
        interval        30;
        limit_kbps      4000;
    }
}